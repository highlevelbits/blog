<!DOCTYPE HTML>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>high level bits - WTF!</title>

    <link href="http://fonts.googleapis.com/css?family=Iceland%7CVolkhov" rel="stylesheet" type="text/css">

    <link href="../../awesome/font-awesome-min.css" rel="stylesheet">
    <link href="../../style.css" rel="stylesheet">
    <link href="../../forms.css" rel="stylesheet">

    <link rel="alternate" type="application/atom+xml" title="high level bits" href="../../atom.xml">

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.7.4">

    <!-- google analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1370334-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <!-- end google analytics -->
  </head>
  <body>
    <div class="main">
      <div class="header">
        <div class="twitter-window">
          <a href="https://twitter.com/highlevelbits" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @highlevelbits</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
        <a href="../../">
          <h1>h1ghlevelb1ts</h1>
        </a>
      </div>
      <div class="menu">
        <a href="../../">home</a>
        ·
        <a href="../../archive.html">archive</a>
        ·
        <a href="http://about.me/hardyferentschik">hardy</a>
        ·
        <a href="http://about.me/fredrik.rubensson">fredrik</a>
      </div>
      <div class="content">
        <h2 class="article-header">
  WTF!
</h2>
<div>
  <span class="byline">2009-04-05 by hardy</span>
  
    <span class="tags">
      
        <a class="one-tag" href="../../tags/sed.html" rel="tag"><span class="icon-tag"></span>sed</a>
      
    </span>
  
</div>
<div class="inner-content">
  I have to start this blog with a rant. I am currently working at <a href="http://www.hibernate.org/412.html" id="supl" title="Hibernate's reference implementation">Hibernate's reference implementation</a>  of <a href="http://jcp.org/aboutJava/communityprocess/edr/jsr303/index.html" id="po9_" title="JSR 303">JSR 303</a>. I started out using <a href="http://www.junit.org/" id="cnko" title="Junit 4">Junit 4</a>  for unit tests.  However, in order to leverage from some other framework I had to switch to <a href="http://testng.org/" id="m3yl" title="TestNG">TestNG</a>. I thought it should be quite easy to change from one framework to the other - basically just switch the import statements. Turns out is was more difficult than that. After a global find and replace in the test files replacing the package statement I ended up with multiple compilation errors. The problem was that in Junit the assertEquals method has the signature <i>assertEquals(String message, Object expected, Object actual)</i> whereas TestNG's assertEquals is <i>assertEquals(Object expected, Object actual, String message). </i>WTF! Given that TestNG came later - which reason did they have to swap the arguments? Just to make it harder to migrate from one to the other? This applies of course for all assert statements. I am just using assertEquals as an exmaple.<br><br>Anyways, I started manually changing the calls, but that was just too tedious. It was time to get <a href="http://www.gnu.org/software/sed/manual/sed.htm" id="bf60" title="sed">sed</a>  out again, but soon I realized that sed was not going to cut it this time, because there is no way do non <a href="http://en.wikipedia.org/wiki/Regular_expression" id="us_t" title="greedy regular expressions">greedy regular expressions</a> . The expression also had to take care of single and multi line statements. An example for a multi line statement would be:<br><blockquote>
<br>assertEquals(                              <br>       "Wrong propertyPath",  <br>       propertyPath,   <br>       violation.getPropertyPath()<br>   );<br>
</blockquote>
<br>Time to get good old perl out again. Here is what I came up with (the whole expression is one line!):<br><blockquote> <br>perl -pi -0777 -e 's/(assertEquals.|\n*?)(".*?"),[ ,\n,\t]*(\w*?,)([ ,\n,\t]*.*?)([ ,\n,\t]*)\);/$1$3$4,$5$2\ );/g' MyClass.java<br>
</blockquote>
<br>Well, it did not solve all my problems. In some cases the formatting was a little off, but that could be easily fixed with my IDE. Some comments about the expression:<br><ul>
<li>the -i option allows editing of the file in-line. A very nice feature of perl and something I miss a lot in sed</li>
<li>-0777 specified the line break character in octa-decimal. Assuming 777 does not appear in your file this is an easy way to match across lines</li>
<li>there are a lot of \n matches. Even when matching across the whole file .* won't match the new line character. It has to be explicitly specified</li>
<li>using regular expression buffers I am able to capture the groups of the statement an put the expression together in a different order using $x notation for referring to the matching buffers</li>
<li>and I almost forgot the ? after the operators ?, <span style="font-style: italic;">+</span> and <span style="font-style: italic;">*</span> turns on non greedy machting<br>
</li>
</ul>Admittedly, I could have almost changed all statements manually in the time I figured out the regular expression, but this solution was ways more satisfactory :)<br><br>enjoy!<div class="old-comments">
<h2>Old comments</h2>
<div class="one-old-comment">
<span class="comment-date">2009-04-05</span><span class="commenter-name">Cedric</span><div class="comment-body">You could also have used the AssertJUnit class, which is a copy of JUnit's class, so it's just a one line change per file...</div>
</div>
<div class="one-old-comment">
<span class="comment-date">2009-04-05</span><span class="commenter-name">Fredrik Rubensson</span><div class="comment-body">WTF indeed! The whole Java thing seems to be a complexity conspiracy. (Don't get me started on portlets....)</div>
</div>
<div class="one-old-comment">
<span class="comment-date">2009-04-05</span><span class="commenter-name">Hardy Ferentschik</span><div class="comment-body">Right. I wish the TestNG documentation would have made AssertJunit more visible. Not only a little node at the end of the <a href="http://testng.org/doc/documentation-main.html" rel="nofollow">documentation</a>. Or what's about adding a comment to the <a href="http://testng.org/doc/migrating.html" rel="nofollow">migration guide</a>? What can we learn from this? There are many ways to skin a cat! And of course there is a big Java complexity conspiracy going on ;-)</div>
</div>
<div class="one-old-comment">
<span class="comment-date">2009-04-05</span><span class="commenter-name">Cedric</span><div class="comment-body">Good point about the migration guide, I updated it to reflect this.<br><br>Thanks!</div>
</div>
<div class="one-old-comment">
<span class="comment-date">2009-04-05</span><span class="commenter-name">Hardy Ferentschik</span><div class="comment-body">Thanks to you :)</div>
</div>
</div>
</div>

<div class="dashed-top-border">
  <!-- disqus -->
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'highlevelbits'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  <!-- end disqus -->
</div>

      </div>
      <div class="footer">
        high level bits was brought to you by
        <a href="http://about.me/hardyferentschik">hardy</a>
        and
        <a href="http://about.me/fredrik.rubensson">fredrik</a>
      </div>
    </div>
  </body>
</html>
