<!DOCTYPE HTML>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>high level bits - OpenShift and Drupal</title>
    <link href="http://fonts.googleapis.com/css?family=Iceland%7CVolkhov" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../../awesome/font-awesome-min.css">
    <link rel="stylesheet" href="../../style.css">
    <link rel="alternate" type="application/atom+xml" title="high level bits" href="../../atom.xml">

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.6.2">

    <!-- google analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1370334-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <!-- end google analytics -->
  </head>
  <body>
    <div class="main">
      <div class="header">
        <div class="twitter-window">
          <a href="https://twitter.com/highlevelbits" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @highlevelbits</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
        <h1>h1ghlevelb1ts</h1>
      </div>
      <div class="menu">
        <a href="../../">home</a>
        ·
        <a href="../../archive.html">archive</a>
        ·
        <a href="http://about.me/hardyferentschik">hardy</a>
        ·
        <a href="http://about.me/fredrik.rubensson">fredrik</a>
      </div>
      <div class="content">
        <h2 class="article-header">
  OpenShift and Drupal
</h2>
<span class="byline">2011-12-29 by hardy</span>

  <span class="tags">
    
      <a class="one-tag" href="#openshift"><span class="icon-tag"></span>openshift</a>
    
      <a class="one-tag" href="#drupal"><span class="icon-tag"></span>drupal</a>
    
  </span>

<p>Over the Christmas holidays I had some more time for <a href="https://openshift.redhat.com/">OpenShift</a> Express experiments. This time I experimented with <a href="http://drupal.org/">Drupal</a> based on this <a href="https://github.com/openshift/drupal-example">template</a>.<br><br>After a slightly bumpy start and a quick <a href="https://github.com/openshift/drupal-example/pull/3">pull request</a> I got the basic installation up and running. One problem I encountered now, however, was that there is no easy way to manage data created by the application once running.<br><br>For example, Drupal users can upload images (per default into <i>sites/default/files</i>). Naturally I would like to add these uploaded resources under version control as well. However, that's not possible at the moment. OpenShift Express had the notion of a <i><b>OPENSHIFT_DATA_DIR</b></i> directory whose content is preserved between redeploys, but this directory is outside of the git repository. What I really want is to be able to use the same resource directory for my local development as well as on the remote site and manage the resources via git.<br><br>Locally I can add resources created in <i>sites/default/files </i>directly to git, but how to solve this on the sever side? The first problem I had, which I already encountered when installing <a href="http://www.highlevelbits.com/2011/11/gollum-wiki-reloaded.html">Gollum</a> on OpenShift, was that the repo directory from which the application is run from is not a git <a href="http://linux.die.net/man/1/git-clone">clone</a>, but an git <a href="http://linux.die.net/man/1/git-archive">archive</a> which means that there are no git control files. If <i><b>OPENSHIFT_REPO_DIR</b></i> were a git clone I could somehow add created files to the git repo, commit, push and finally pull it into my local environment. Unfortunately, the OpenShift gang decided for now against a full git clone mainly (afaik) due to size concerns. The good news is that there is a way to fix this yourself with some lines in the <i>.openshift/action_hooks/build</i> hook:</p>
<pre class="code">
cd $OPENSHIFT_HOMEDIR/$OPENSHIFT_APP_NAME/runtime
rm -rf repo
git clone $OPENSHIFT_HOMEDIR/git/$OPENSHIFT_APP_NAME.git repo
</pre>
<p>This will delete the git archive and and replace it with a git clone. This is of course only half the rent. Somehow you need to add and commit new content on the server side. One way is to add some more code to the build hook,but so far I went with another simpler solution. I just <i>ssh</i> into onto the remote server.  As far as I know this was not always possible, but it is now. Just check your git remote url via <i>git remote -v</i> or <i>rhc-user-info</i>.The former will display something like:</p>
<pre class="code">
ssh://&lt;uuid&gt;@&lt;app-name&gt;-&lt;domain&gt;.rhcloud.com/~/git/&lt;app-name&gt;.git
</pre>
<p>To ssh to your app use:</p>
<pre class="code">
ssh &lt;uuid&gt;@&lt;app-name&gt;-&lt;domain&gt;
</pre>
<p>Once you are on the server you can change into <i><b>OPENSHIFT_REPO_DIR</b></i> run your git commands and finally git push. Once you've done that you can do a git pull from your local machine. The disadvatange of this method is that a git push on the remote server is of course running the git hooks meaning you are forcing a redeploy. Whether this is a bad thing depends on the usecase. An alternative could be to use scp to copy new resources to the local machine and then add them there, but of course you would need a way to determine what to copy.<br><br>As you can see, I am also still figuring things out. I haven't yet found an approach I am really happy with, but I am getting there :-) Let me know what you think.<br><br>--Hardy<br><br>P.S. For the Mac developers out there. To develop my Drupal app locally using the default Apache server I added the following to <i>/System/Library/LaunchDaemons/org.apache.httpd.plist</i>:<br> </p>
<pre class="code">
&lt;!--?xml version="1.0" encoding="UTF-8"?--&gt;

&lt;plist version="1.0"&gt;
&lt;dict&gt;
        ...
        &lt;string&gt;system.preferences&lt;/string&gt;
        &lt;key&gt;EnvironmentVariables&lt;/key&gt;
        &lt;dict&gt;
                &lt;key&gt;OPENSHIFT_APP_NAME&lt;/key&gt;
                &lt;string&gt;myapp&lt;/string&gt;
                &lt;key&gt;OPENSHIFT_DB_USERNAME&lt;/key&gt;
                &lt;string&gt;mydbuser&lt;/string&gt;
                &lt;key&gt;OPENSHIFT_DB_PASSWORD&lt;/key&gt;
                &lt;string&gt;mydbpass&lt;/string&gt;
                &lt;key&gt;OPENSHIFT_DB_HOST&lt;/key&gt;
                &lt;string&gt;127.0.0.1&lt;/string&gt;
                &lt;key&gt;OPENSHIFT_DB_PORT&lt;/key&gt;
                &lt;string&gt;3306&lt;/string&gt;
        &lt;/dict&gt;
&lt;/dict&gt;
&lt;/plist&gt;

</pre>
<p>This way I can develop my Drupal application locally without making any changes to <i>settings.php</i> in <i>php/sites/default</i> which contains the database connection settings.</p>
<div class="old-comments">
<h2>Old comments</h2>
<div class="one-old-comment">
<span class="comment-date">2013-02-06</span><span class="commenter-name">Sokratis</span><div class="comment-body">Hi there,I would like to ask if this is possible to host drupal sites in Openshift.Also is this possible to host Drupal sites?thanks</div>
</div>
</div>

<div class="dashed-top-border">
  <!-- disqus -->
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'highlevelbits'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  <!-- end disqus -->
</div>


  <div class="dashed-top-border">
    
      
      
        <h4><a name="openshift">Other articles tagged openshift</a></h4>
        <ul>
          
            <li>
              <a href="../11/gollum-wiki-reloaded.html">Gollum wiki reloaded</a>
            </li>
          
            <li>
              <a href="../11/my-precious-wiki.html">My precious wiki</a>
            </li>
          
        </ul>
      
    
      
      
        <h4><a name="drupal">Other articles tagged drupal</a></h4>
        <ul>
          
            <li>
              <a href="../../2013/04/nanoc.html">moving from drupal to nanoc</a>
            </li>
          
        </ul>
      
    
  </div>


      </div>
      <div class="footer">
        high level bits was brought to you by
        <a href="http://about.me/hardyferentschik">hardy</a>
        and
        <a href="http://about.me/fredrik.rubensson">fredrik</a>
      </div>
    </div>
  </body>
</html>
